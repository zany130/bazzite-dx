#!/bin/bash

USERNAME="zany130"
ALGA_PATH="/home/${USERNAME}/.local/bin/alga"

if systemctl list-jobs | grep -q -E 'reboot.target.*start'; then
    echo "Rebooting, no action"
    exit 0
fi

power_state=$("$ALGA_PATH" power screen-state 2>/dev/null | cut -d':' -f2 | xargs)

if [[ "$power_state" == "Active" ]]; then
    echo "Turning off TV"
    "$ALGA_PATH" power off
else
    echo "TV already off"
fi