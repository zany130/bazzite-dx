#!/bin/bash

USERNAME="zany130"
ALGA_PATH="/home/${USERNAME}/.local/bin/alga"
TV_INPUT="HDMI_1"

if ! nm-online -q -t 60; then
    echo "Network not available"
    exit 1
fi

if [[ ! -x "$ALGA_PATH" ]]; then
    echo "alga not found at $ALGA_PATH"
    exit 1
fi

power_state=$("$ALGA_PATH" power screen-state 2>/dev/null | cut -d':' -f2 | xargs)

if [[ "$power_state" != "Active" ]]; then
    echo "Turning on TV and switching to $TV_INPUT"
    "$ALGA_PATH" power on
    sleep 7
    "$ALGA_PATH" input set "$TV_INPUT"
else
    echo "TV already on, checking input"
    current_input=$("$ALGA_PATH" input get 2>/dev/null | grep -o 'HDMI_[0-9]\+')
    if [[ "$current_input" != "$TV_INPUT" ]]; then
        echo "Switching to $TV_INPUT"
        "$ALGA_PATH" input set "$TV_INPUT"
    fi
fi
